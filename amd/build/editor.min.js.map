{"version":3,"file":"editor.min.js","sources":["../src/editor.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Course structure JSON editor\n *\n * @module     block_dixeo_coursegen/editor\n * @package\n * @author     Josemaria Bolanos <admin@mako.digital>\n * @copyright  2026 Dixeo (contact@dixeo.com)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification', 'core/str', 'core/templates'],\n    function($, Ajax, Notification, Str, Templates) {\n\n    /** Module type options for the type select: value (stored in JSON), label, icon. */\n    var MODULE_TYPE_OPTIONS = [\n        {value: 'Page', label: 'Page', icon: 'fa-file-alt'},\n        {value: 'Text and Media area', label: 'Text and Media area', icon: 'fa-book'},\n        {value: 'Glossary', label: 'Glossary', icon: 'fa-list-alt'},\n        {value: 'Slideshow', label: 'Slideshow', icon: 'fa-images'},\n        {value: 'URL', label: 'URL', icon: 'fa-link'},\n        {value: 'Simple Quiz', label: 'Simple Quiz', icon: 'fa-question-circle'},\n        {value: 'Quiz', label: 'Quiz', icon: 'fa-check-square'},\n        {value: 'H5P Quiz', label: 'H5P Quiz', icon: 'fa-puzzle-piece'},\n        {value: 'Flash Cards', label: 'Flash Cards', icon: 'fa-id-card'},\n        {value: 'Crosswords', label: 'Crosswords', icon: 'fa-th-large'},\n        {value: 'Find the words', label: 'Find the words', icon: 'fa-search'}\n    ];\n\n    var Editor = {\n        jobid: null,\n        version: '',\n        structure: null,\n        historyIndex: -1,\n        historyTotal: 0,\n        versions: [],\n        autoSaveInterval: null,\n        countdownInterval: null,\n        countdown: 60,\n        currentlyEditing: null,\n        hasUnsavedChanges: false,\n        autoSaveEnabled: false,\n        pendingCollapseState: null,\n\n        /**\n         * Initialize the editor\n         * @param {string} jobid\n         */\n        init: function(jobid) {\n            this.jobid = jobid;\n\n            // Show loading indicator initially\n            this.showLoading();\n\n            // Load versions first to get history, then structure\n            this.loadVersions();\n\n            // Set up auto-save\n            this.startAutoSave();\n\n            // Set up event handlers\n            this.setupEventHandlers();\n        },\n\n        /**\n         * Show loading indicator\n         */\n        showLoading: function() {\n            var container = $('.course-structure-container');\n            Str.get_string('editor_loading', 'block_dixeo_coursegen').done(function(str) {\n                container.html('<div id=\"loading-indicator\" class=\"text-center py-5\">' +\n                    '<i class=\"fa fa-spinner fa-spin fa-3x\"></i>' +\n                    '<p class=\"mt-3\">' + str + '</p>' +\n                    '</div>');\n            });\n        },\n\n        /**\n         * Load structure from server\n         * @param {number} index Optional history index (loads latest if -1 or not provided)\n         */\n        loadStructure: function(index) {\n            var self = this;\n            var loadIndex = (index !== undefined) ? index : -1;\n\n            Ajax.call([{\n                methodname: 'block_dixeo_coursegen_get_structure',\n                args: {\n                    jobid: this.jobid,\n                    index: loadIndex\n                },\n                done: function(response) {\n                    self.structure = JSON.parse(response.structure);\n                    self.version = response.version;\n                    self.historyIndex = response.index;\n                    self.historyTotal = response.total;\n                    self.renderStructure();\n                    self.updateUndoRedoButtons();\n                },\n                fail: function(error) {\n                    Notification.exception(error);\n                }\n            }]);\n        },\n\n        /**\n         * Load all versions to track history\n         */\n        loadVersions: function() {\n            var self = this;\n\n            Ajax.call([{\n                methodname: 'block_dixeo_coursegen_get_versions',\n                args: {\n                    jobid: this.jobid\n                },\n                done: function(versions) {\n                    self.versions = versions;\n                    self.historyTotal = versions.length;\n                    // Load structure after versions are loaded\n                    self.loadStructure();\n                },\n                fail: function(error) {\n                    Notification.exception(error);\n                }\n            }]);\n        },\n\n        /**\n         * Save structure to server (creates new version)\n         */\n        saveStructure: function() {\n            var self = this;\n\n            // Don't save if there are no unsaved changes\n            if (!this.hasUnsavedChanges) {\n                return;\n            }\n\n            // Show saving indicator\n            this.showSavingIndicator();\n\n            Ajax.call([{\n                methodname: 'block_dixeo_coursegen_save_structure',\n                args: {\n                    jobid: this.jobid,\n                    structure: JSON.stringify(this.structure),\n                    current_index: this.historyIndex\n                },\n                done: function(response) {\n                    self.version = response.version;\n                    self.historyIndex = response.index;\n                    self.historyTotal = response.total;\n                    // Reload versions list to update history\n                    self.loadVersions();\n                    self.showSavedIndicator();\n\n                    // Disable auto-save after saving until a new modification is made\n                    self.clearModified();\n\n                    // Update undo/redo buttons\n                    self.updateUndoRedoButtons();\n                },\n                fail: function(error) {\n                    Notification.exception(error);\n                }\n            }]);\n        },\n\n        /**\n         * Render the structure as HTML using Mustache templates\n         */\n        renderStructure: function() {\n            var self = this;\n            var container = $('.course-structure-container');\n            container.empty();\n\n            if (!this.structure || !this.structure.title) {\n                var self = this;\n                Str.get_string('editor_invalid_data', 'block_dixeo_coursegen').done(function(str) {\n                    container.html('<div class=\"alert alert-danger\">' + str + '</div>');\n                });\n                return;\n            }\n\n            // Prepare template context\n            // Note: We don't escape HTML here because Mustache auto-escapes {{}} variables\n            var templateContext = {\n                title: this.structure.title || '',\n                summary: this.structure.summary || null,\n                image: this.structure.image || null,\n                jobid: this.jobid,\n                hasSections: this.structure.sections && this.structure.sections.length > 0,\n                sections: []\n            };\n\n            // Process sections\n            if (this.structure.sections && this.structure.sections.length > 0) {\n                this.structure.sections.forEach(function(section, sectionIdx) {\n                    var sectionData = {\n                        index: sectionIdx,\n                        number: sectionIdx + 1,\n                        title: section.title || '',\n                        summary: section.summary || null,\n                        jobid: self.jobid,\n                        hasModules: section.modules && section.modules.length > 0,\n                        modules: []\n                    };\n\n                    // Process modules\n                    if (section.modules && section.modules.length > 0) {\n                        section.modules.forEach(function(module, moduleIdx) {\n                            var iconClass = self.getModuleIcon(module.type);\n                            var moduleType = module.type || '';\n                            sectionData.modules.push({\n                                index: moduleIdx,\n                                sectionIndex: sectionIdx,\n                                type: moduleType,\n                                typeUpper: moduleType.toUpperCase(),\n                                title: module.title || '',\n                                hints: module.hints || null,\n                                icon: iconClass,\n                                jobid: self.jobid,\n                                moduleTypeOptions: MODULE_TYPE_OPTIONS\n                            });\n                        });\n                    }\n\n                    templateContext.sections.push(sectionData);\n                });\n            }\n\n            // Update hasSections after populating (in case structure was empty)\n            templateContext.hasSections = templateContext.sections.length > 0;\n\n            // Load language strings and render template\n            var stringsPromise = Str.get_strings([\n                {key: 'editor_edit', component: 'block_dixeo_coursegen'},\n                {key: 'editor_duplicate', component: 'block_dixeo_coursegen'},\n                {key: 'editor_delete', component: 'block_dixeo_coursegen'},\n                {key: 'editor_add_section', component: 'block_dixeo_coursegen'},\n                {key: 'editor_add_activity', component: 'block_dixeo_coursegen'},\n                {key: 'editor_change_activity_type', component: 'block_dixeo_coursegen'}\n            ]);\n\n            stringsPromise.then(function(strings) {\n                templateContext.strings = {\n                    edit: strings[0],\n                    duplicate: strings[1],\n                    delete: strings[2],\n                    add_section: strings[3],\n                    add_activity: strings[4],\n                    change_activity_type: strings[5]\n                };\n\n                return Templates.render('block_dixeo_coursegen/course_structure', templateContext);\n            }).then(function(html) {\n                container.html(html);\n                self.setupEventHandlersAfterRender();\n            }).catch(function(error) {\n                Notification.exception(error);\n                Str.get_string('editor_invalid_data', 'block_dixeo_coursegen').done(function(str) {\n                    container.html('<div class=\"alert alert-danger\">' + str + '</div>');\n                });\n            });\n        },\n\n        /**\n         * Set up event handlers after rendering\n         */\n        setupEventHandlersAfterRender: function() {\n\n            // Set up collapse handlers\n            this.setupCollapseHandlers();\n\n            // Set up editable handlers\n            this.setupEditableHandlers();\n\n            // Set up action button handlers\n            this.setupActionHandlers();\n\n            // Set up module type select (icon â†’ dropdown)\n            this.setupModuleTypeSelectHandlers();\n\n            // Set up drag and drop\n            this.setupDragAndDrop();\n\n            // Restore collapse state if pending (e.g., after drag-and-drop)\n            if (this.pendingCollapseState) {\n                this.restoreCollapseState(this.pendingCollapseState);\n                this.pendingCollapseState = null;\n            }\n        },\n\n        /**\n         * Get Font Awesome icon class for module type\n         * @param {string} type Module type\n         * @return {string} Font Awesome icon class\n         */\n        getModuleIcon: function(type) {\n            if (!type) {\n                return 'fa-file-alt';\n            }\n            var t = type.toLowerCase();\n            var i;\n            for (i = 0; i < MODULE_TYPE_OPTIONS.length; i++) {\n                if (MODULE_TYPE_OPTIONS[i].value.toLowerCase() === t) {\n                    return MODULE_TYPE_OPTIONS[i].icon;\n                }\n            }\n            return 'fa-file-alt';\n        },\n\n        /**\n         * Escape HTML\n         * @param {string} text Text to escape\n         * @return {string} Escaped HTML\n         */\n        escapeHtml: function(text) {\n            if (!text) {\n                return '';\n            }\n            var div = document.createElement('div');\n            div.textContent = text;\n            return div.innerHTML;\n        },\n\n        /**\n         * Decode HTML entities\n         * @param {string} text Text with HTML entities\n         * @return {string} Decoded text\n         */\n        decodeHtml: function(text) {\n            if (!text) {\n                return '';\n            }\n            var textarea = document.createElement('textarea');\n            textarea.innerHTML = text;\n            return textarea.value;\n        },\n\n        /**\n         * Capture current collapse state (which sections are expanded)\n         * @return {Object} Object mapping section index to expanded state\n         */\n        captureCollapseState: function() {\n            var self = this;\n            var expandedSections = {};\n            $('.section-item').each(function() {\n                var sectionIdx = $(this).data('section-idx');\n                var collapseTarget = $('#section-' + self.jobid + '-' + sectionIdx);\n                expandedSections[sectionIdx] = collapseTarget.hasClass('show');\n            });\n            return expandedSections;\n        },\n\n        /**\n         * Adjust expanded section indices after a section reorder\n         * @param {Object} expandedSections Original expanded sections map\n         * @param {number} fromIndex Original index of moved section\n         * @param {number} toIndex New index of moved section\n         * @return {Object} Adjusted expanded sections map\n         */\n        adjustExpandedIndices: function(expandedSections, fromIndex, toIndex) {\n            if (fromIndex === toIndex) {\n                return expandedSections;\n            }\n\n            var adjusted = {};\n\n            Object.keys(expandedSections).forEach(function(idxStr) {\n                var idx = parseInt(idxStr);\n                var wasExpanded = expandedSections[idx];\n\n                if (idx === fromIndex) {\n                    // The moved section will be at toIndex\n                    if (wasExpanded) {\n                        adjusted[toIndex] = true;\n                    }\n                } else if (fromIndex < toIndex) {\n                    // Moving forward: sections between fromIndex and toIndex shift back\n                    if (idx > fromIndex && idx <= toIndex) {\n                        adjusted[idx - 1] = wasExpanded;\n                    } else {\n                        adjusted[idx] = wasExpanded;\n                    }\n                } else {\n                    // Moving backward: sections between toIndex and fromIndex shift forward\n                    if (idx >= toIndex && idx < fromIndex) {\n                        adjusted[idx + 1] = wasExpanded;\n                    } else {\n                        adjusted[idx] = wasExpanded;\n                    }\n                }\n            });\n\n            return adjusted;\n        },\n\n        /**\n         * Restore collapse state after re-rendering\n         * @param {Object} expandedSections Object mapping section index to expanded state\n         */\n        restoreCollapseState: function(expandedSections) {\n            var self = this;\n            Object.keys(expandedSections).forEach(function(sectionIdx) {\n                if (expandedSections[sectionIdx]) {\n                    var collapseTarget = $('#section-' + self.jobid + '-' + sectionIdx);\n                    var toggleButton = $('[data-target=\"#section-' + self.jobid + '-' + sectionIdx + '\"]');\n                    var icon = toggleButton.find('i');\n\n                    collapseTarget.addClass('show');\n                    icon.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n                    toggleButton.attr('aria-expanded', 'true').removeClass('collapsed');\n                }\n            });\n        },\n\n        /**\n         * Set up collapse/expand handlers\n         */\n        setupCollapseHandlers: function() {\n            $('[data-toggle=\"collapse\"]').off('click').on('click', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                var target = $($(this).data('target'));\n                var icon = $(this).find('i');\n\n                if (target.hasClass('show')) {\n                    target.removeClass('show');\n                    icon.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n                    $(this).attr('aria-expanded', 'false').addClass('collapsed');\n                } else {\n                    target.addClass('show');\n                    icon.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n                    $(this).attr('aria-expanded', 'true').removeClass('collapsed');\n                }\n            });\n        },\n\n        /**\n         * Set up editable field handlers\n         */\n        setupEditableHandlers: function() {\n            var self = this;\n\n            $('.editable').off('click').on('click', function() {\n                if (self.currentlyEditing) {\n                    return;\n                }\n\n                self.startEditing($(this));\n            });\n        },\n\n        /**\n         * Start editing a field\n         * @param {jQuery} $element Element to edit\n         */\n        startEditing: function($element) {\n            var self = this;\n            this.currentlyEditing = $element;\n\n            var originalText = $element.text();\n            var path = $element.data('path');\n\n            $element.addClass('editing');\n            $element.attr('contenteditable', 'true');\n            $element.focus();\n\n            // Select all text\n            var range = document.createRange();\n            range.selectNodeContents($element[0]);\n            var sel = window.getSelection();\n            sel.removeAllRanges();\n            sel.addRange(range);\n\n            // Show save/cancel buttons\n            var $controls = $element.next('.edit-controls');\n            $controls.html($('#edit-controls-template').html());\n            $controls.show();\n\n            // Save button\n            $controls.find('.save-edit').off('click').on('click', function() {\n                var newText = $element.text().trim();\n                self.saveEdit($element, path, newText);\n            });\n\n            // Cancel button\n            $controls.find('.cancel-edit').off('click').on('click', function() {\n                $element.text(originalText);\n                self.cancelEdit($element);\n            });\n\n            // Save on Enter (except for hints and summaries which might be multi-line)\n            if (!$element.hasClass('module-hints') && !$element.hasClass('course-summary')) {\n                $element.off('keydown').on('keydown', function(e) {\n                    if (e.key === 'Enter') {\n                        e.preventDefault();\n                        $controls.find('.save-edit').click();\n                    } else if (e.key === 'Escape') {\n                        $element.text(originalText);\n                        self.cancelEdit($element);\n                    }\n                });\n            }\n        },\n\n        /**\n         * Save edited field\n         * @param {jQuery} $element Element being edited\n         * @param {string} path Data path\n         * @param {string} value New value\n         */\n        saveEdit: function($element, path, value) {\n            // Decode HTML entities before saving (e.g., &amp; -> &)\n            var decodedValue = this.decodeHtml(value);\n\n            // Update structure in memory\n            this.setValueByPath(this.structure, path, decodedValue);\n\n            // Mark as modified to enable auto-save\n            this.markAsModified();\n\n            // Clean up editing state\n            this.cancelEdit($element);\n\n            // Update displayed value (no section number prefix)\n            $element.text(decodedValue);\n        },\n\n        /**\n         * Cancel editing\n         * @param {jQuery} $element Element being edited\n         */\n        cancelEdit: function($element) {\n            $element.removeClass('editing');\n            $element.removeAttr('contenteditable');\n            $element.next('.edit-controls').hide().empty();\n            this.currentlyEditing = null;\n        },\n\n        /**\n         * Set value in structure by path\n         * @param {Object} obj Object to modify\n         * @param {string} path Path to property\n         * @param {string} value New value\n         */\n        setValueByPath: function(obj, path, value) {\n            var parts = path.match(/([^\\[\\]\\.]+)|(\\[\\d+\\])/g);\n            var current = obj;\n\n            for (var i = 0; i < parts.length - 1; i++) {\n                var key = parts[i].replace(/[\\[\\]]/g, '');\n                current = current[key];\n            }\n\n            var finalKey = parts[parts.length - 1].replace(/[\\[\\]]/g, '');\n            current[finalKey] = value;\n        },\n\n        /**\n         * Set up action button handlers\n         */\n        setupActionHandlers: function() {\n            var self = this;\n\n            // Edit button (same as clicking the text)\n            $('.btn-edit-item').off('click').on('click', function(e) {\n                e.stopPropagation();\n                var $item = $(this).closest('.section-item, .module-item');\n                var $title = $item.find('.section-title, .module-title').first();\n                $title.click();\n            });\n\n            // Copy button\n            $('.btn-copy-item').off('click').on('click', function(e) {\n                e.stopPropagation();\n                self.duplicateItem($(this));\n            });\n\n            // Delete button\n            $('.btn-delete-item').off('click').on('click', function(e) {\n                e.stopPropagation();\n                self.deleteItem($(this));\n            });\n\n            // Add section button\n            $('.btn-add-section').off('click').on('click', function(e) {\n                e.stopPropagation();\n                var sectionIndex = parseInt($(this).data('section-index'));\n                self.addSection(sectionIndex);\n            });\n\n            // Add module/activity button\n            $('.btn-add-module').off('click').on('click', function(e) {\n                e.stopPropagation();\n                var sectionIndex = parseInt($(this).data('section-index'));\n                var moduleIndex = parseInt($(this).data('module-index'));\n                self.addModule(sectionIndex, moduleIndex);\n            });\n        },\n\n        /**\n         * Set up module type select: toggle dropdown, option select, click outside to close\n         */\n        setupModuleTypeSelectHandlers: function() {\n            var self = this;\n\n            /** Close all open module-type dropdowns. */\n            function closeAllDropdowns() {\n                $('.module-type-select-dropdown').addClass('d-none').attr('aria-hidden', 'true');\n                $('.module-type-select-toggle').attr('aria-expanded', 'false');\n            }\n\n            /**\n             * Open the dropdown for a given wrapper\n             * @param {jQuery} $wrapper The wrapper element containing the dropdown\n             */\n            function openDropdown($wrapper) {\n                var $dropdown = $wrapper.find('.module-type-select-dropdown');\n                var $toggle = $wrapper.find('.module-type-select-toggle');\n                var isOpen = !$dropdown.hasClass('d-none');\n\n                // Close all dropdowns first\n                closeAllDropdowns();\n\n                // If this one wasn't open, open it now\n                if (!isOpen) {\n                    $dropdown.removeClass('d-none').attr('aria-hidden', 'false');\n                    $toggle.attr('aria-expanded', 'true');\n                }\n            }\n\n            // Use event delegation for dynamically added elements\n            $(document).off('click', '.module-type-select-toggle').on('click', '.module-type-select-toggle', function(e) {\n                e.stopPropagation();\n                e.preventDefault();\n                var $wrapper = $(this).closest('.module-type-select-wrapper');\n                openDropdown($wrapper);\n            });\n\n            // Also open dropdown when clicking module-type div\n            $(document).off('click', '.module-type').on('click', '.module-type', function(e) {\n                e.stopPropagation();\n                var $moduleItem = $(this).closest('.module-item');\n                var $wrapper = $moduleItem.find('.module-type-select-wrapper');\n                if ($wrapper.length) {\n                    openDropdown($wrapper);\n                }\n            });\n\n            // Use event delegation for dynamically added elements\n            $(document).off('click', '.module-type-option').on('click', '.module-type-option', function(e) {\n                e.stopPropagation();\n                var value = $(this).data('value');\n                var $wrapper = $(this).closest('.module-type-select-wrapper');\n                var sectionIdx = parseInt($wrapper.data('section-index'), 10);\n                var moduleIdx = parseInt($wrapper.data('module-index'), 10);\n\n                // Find the option (use for loop for compatibility)\n                var opt = null;\n                var i;\n                for (i = 0; i < MODULE_TYPE_OPTIONS.length; i++) {\n                    if (MODULE_TYPE_OPTIONS[i].value === value) {\n                        opt = MODULE_TYPE_OPTIONS[i];\n                        break;\n                    }\n                }\n\n                if (!opt) {\n                    return;\n                }\n\n                // Update structure\n                self.structure.sections[sectionIdx].modules[moduleIdx].type = value;\n\n                // Update UI: icon and type text (exclude chevron)\n                $wrapper.find('.module-type-select-toggle i').not('.module-type-select-chevron')\n                    .removeClass().addClass('fa ' + opt.icon + ' fa-2x');\n                var $moduleType = $wrapper.closest('.module-item').find('.module-type');\n                if ($moduleType.length) {\n                    $moduleType.text(value.toUpperCase());\n                }\n\n                closeAllDropdowns();\n                self.markAsModified();\n            });\n\n            $(document).off('click.module-type-select').on('click.module-type-select', function(e) {\n                if (!$(e.target).closest('.module-type-select-wrapper').length) {\n                    closeAllDropdowns();\n                }\n            });\n\n            // Highlight toggle and module-type when hovering over toggle\n            $(document).off('mouseenter mouseleave', '.module-type-select-toggle')\n                .on('mouseenter mouseleave', '.module-type-select-toggle', function(e) {\n                    var $moduleItem = $(this).closest('.module-item');\n                    var $moduleType = $moduleItem.find('.module-type');\n                    if (e.type === 'mouseenter') {\n                        $(this).addClass('highlighted');\n                        $moduleType.addClass('highlighted');\n                    } else {\n                        // Only remove highlight if module-type is not being hovered\n                        if (!$moduleType.is(':hover')) {\n                            $(this).removeClass('highlighted');\n                            $moduleType.removeClass('highlighted');\n                        }\n                    }\n                });\n\n            // Also highlight toggle when hovering over module-type (if not already highlighted)\n            $(document).off('mouseenter mouseleave', '.module-type').on('mouseenter mouseleave', '.module-type', function(e) {\n                var $moduleItem = $(this).closest('.module-item');\n                var $toggle = $moduleItem.find('.module-type-select-toggle');\n                if (e.type === 'mouseenter') {\n                    $toggle.addClass('highlighted');\n                    $(this).addClass('highlighted');\n                } else {\n                    // Only remove highlight if toggle is not being hovered\n                    if (!$toggle.is(':hover')) {\n                        $toggle.removeClass('highlighted');\n                        $(this).removeClass('highlighted');\n                    }\n                }\n            });\n        },\n\n        /**\n         * Add a new section\n         * @param {number} index Index where to insert the section\n         */\n        addSection: function(index) {\n            var self = this;\n            // Capture collapse state before re-rendering\n            var expandedSections = this.captureCollapseState();\n\n            // Load language strings for defaults\n            Str.get_strings([\n                {key: 'editor_new_section_title', component: 'block_dixeo_coursegen'},\n                {key: 'editor_new_section_summary', component: 'block_dixeo_coursegen'}\n            ]).done(function(strings) {\n                var newSection = {\n                    title: strings[0],\n                    summary: strings[1],\n                    modules: []\n                };\n\n                // Insert at the specified index\n                self.structure.sections.splice(index, 0, newSection);\n\n                // Mark as modified\n                self.markAsModified();\n\n                // Store expanded state to restore after render\n                self.pendingCollapseState = expandedSections;\n\n                self.renderStructure();\n            });\n        },\n\n        /**\n         * Add a new module/activity\n         * @param {number} sectionIndex Index of the section\n         * @param {number} moduleIndex Index where to insert the module\n         */\n        addModule: function(sectionIndex, moduleIndex) {\n            var self = this;\n            // Capture collapse state before re-rendering\n            var expandedSections = this.captureCollapseState();\n\n            // Ensure section has modules array\n            if (!this.structure.sections[sectionIndex].modules) {\n                this.structure.sections[sectionIndex].modules = [];\n            }\n\n            // Load language strings for defaults\n            Str.get_strings([\n                {key: 'editor_new_module_type', component: 'block_dixeo_coursegen'},\n                {key: 'editor_new_module_title', component: 'block_dixeo_coursegen'},\n                {key: 'editor_new_module_hints', component: 'block_dixeo_coursegen'}\n            ]).done(function(strings) {\n                var newModule = {\n                    type: strings[0],\n                    title: strings[1],\n                    hints: strings[2]\n                };\n\n                // Insert at the specified index\n                self.structure.sections[sectionIndex].modules.splice(moduleIndex, 0, newModule);\n\n                // Mark as modified\n                self.markAsModified();\n\n                // Store expanded state to restore after render (and ensure section is expanded)\n                expandedSections[sectionIndex] = true;\n                self.pendingCollapseState = expandedSections;\n\n                self.renderStructure();\n            });\n        },\n\n        /**\n         * Duplicate section or module\n         * @param {jQuery} $button Button that was clicked\n         */\n        duplicateItem: function($button) {\n            // Capture collapse state before re-rendering\n            var expandedSections = this.captureCollapseState();\n\n            var $sectionItem = $button.closest('.section-item');\n            var $moduleItem = $button.closest('.module-item');\n\n            var self = this;\n            // Load language string for copy suffix\n            Str.get_string('editor_copy_suffix', 'block_dixeo_coursegen').done(function(copySuffix) {\n                if ($moduleItem.length > 0) {\n                    // Duplicate module\n                    var sectionIdx = $sectionItem.data('section-idx');\n                    var moduleIdx = $moduleItem.data('module-idx');\n                    var module = JSON.parse(JSON.stringify(self.structure.sections[sectionIdx].modules[moduleIdx]));\n                    module.title = module.title + copySuffix;\n                    self.structure.sections[sectionIdx].modules.splice(moduleIdx + 1, 0, module);\n                } else if ($sectionItem.length > 0) {\n                    // Duplicate section\n                    var sectionIdx = $sectionItem.data('section-idx');\n                    var section = JSON.parse(JSON.stringify(self.structure.sections[sectionIdx]));\n                    section.title = section.title + copySuffix;\n                    self.structure.sections.splice(sectionIdx + 1, 0, section);\n                }\n\n                // Mark as having unsaved changes\n                self.markAsModified();\n\n                // Store expanded state to restore after render\n                self.pendingCollapseState = expandedSections;\n\n                self.renderStructure();\n            });\n        },\n\n        /**\n         * Delete section or module\n         * @param {jQuery} $button Button that was clicked\n         */\n        deleteItem: function($button) {\n            var self = this;\n            var $sectionItem = $button.closest('.section-item');\n            var $moduleItem = $button.closest('.module-item');\n\n            var messageKey = $moduleItem.length > 0 ? 'editor_delete_module_confirm' : 'editor_delete_section_confirm';\n            var titleKey = 'editor_confirm_delete';\n\n            Str.get_strings([\n                {key: titleKey, component: 'block_dixeo_coursegen'},\n                {key: messageKey, component: 'block_dixeo_coursegen'},\n                {key: 'delete', component: 'core'},\n                {key: 'cancel', component: 'core'}\n            ]).done(function(strings) {\n                Notification.confirm(\n                    strings[0],\n                    strings[1],\n                    strings[2],\n                    strings[3],\n                        function() {\n                            // Capture collapse state before re-rendering\n                            var expandedSections = self.captureCollapseState();\n\n                            if ($moduleItem.length > 0) {\n                                // Delete module\n                                var sectionIdx = $sectionItem.data('section-idx');\n                                var moduleIdx = $moduleItem.data('module-idx');\n                                self.structure.sections[sectionIdx].modules.splice(moduleIdx, 1);\n                            } else if ($sectionItem.length > 0) {\n                                // Delete section\n                                var sectionIdx = $sectionItem.data('section-idx');\n                                self.structure.sections.splice(sectionIdx, 1);\n                            }\n\n                            // Mark as having unsaved changes\n                            self.markAsModified();\n\n                            // Store expanded state to restore after render\n                            self.pendingCollapseState = expandedSections;\n\n                            self.renderStructure();\n                        }\n                    );\n                });\n        },\n\n        /**\n         * Mark structure as modified and enable auto-save\n         */\n        markAsModified: function() {\n            this.hasUnsavedChanges = true;\n            // Only enable auto-save and reset countdown on first change\n            if (!this.autoSaveEnabled) {\n                this.autoSaveEnabled = true;\n                this.countdown = 60;\n                $('#countdown-timer').text(this.countdown).removeClass('badge-secondary').addClass('badge-primary').show();\n                $('#autosave-label').show();\n            }\n        },\n\n        /**\n         * Start auto-save timer\n         */\n        startAutoSave: function() {\n            var self = this;\n\n            // Hide countdown timer initially (will be shown when auto-save becomes active)\n            $('#countdown-timer').hide();\n            $('#autosave-label').hide();\n\n            // Countdown timer\n            this.countdownInterval = setInterval(function() {\n                if (self.autoSaveEnabled && self.hasUnsavedChanges) {\n                    self.countdown--;\n                    $('#countdown-timer').text(self.countdown);\n\n                    if (self.countdown <= 0) {\n                        self.saveStructure();\n                    }\n                }\n            }, 1000);\n\n            // Manual save button\n            $('#btn-save-now').on('click', function() {\n                if (self.hasUnsavedChanges) {\n                    self.saveStructure();\n                }\n            });\n\n            // Undo button\n            $('#btn-undo').on('click', function() {\n                self.undo();\n            });\n\n            // Redo button\n            $('#btn-redo').on('click', function() {\n                self.redo();\n            });\n\n            // Reload button\n            $('#btn-reload').on('click', function() {\n                Str.get_string('editor_reload_confirm', 'block_dixeo_coursegen').done(function(confirmMsg) {\n                    if (confirm(confirmMsg)) {\n                        self.hasUnsavedChanges = false;\n                        self.autoSaveEnabled = false;\n                        self.countdown = 60;\n                        // Hide the auto-save indicator\n                        $('#countdown-timer').hide();\n                        $('#autosave-label').hide();\n                        // Reload latest version\n                        self.loadStructure(-1);\n                    }\n                });\n            });\n        },\n\n        /**\n         * Clear modified flag (after save)\n         */\n        clearModified: function() {\n            this.hasUnsavedChanges = false;\n            this.autoSaveEnabled = false;\n            this.countdown = 60;\n            // Hide the auto-save indicator\n            $('#countdown-timer').hide();\n            $('#autosave-label').hide();\n        },\n\n        /**\n         * Set up drag and drop handlers\n         */\n        setupDragAndDrop: function() {\n            var self = this;\n\n            // Make sections draggable\n            $('.section-item').attr('draggable', 'true');\n\n            $('.section-item').on('dragstart', function(e) {\n                e.originalEvent.dataTransfer.effectAllowed = 'move';\n                e.originalEvent.dataTransfer.setData('type', 'section');\n                e.originalEvent.dataTransfer.setData('index', $(this).data('section-idx'));\n                $(this).addClass('dragging');\n            });\n\n            $('.section-item').on('dragend', function() {\n                $(this).removeClass('dragging');\n                $('.drag-over').removeClass('drag-over');\n            });\n\n            $('.section-item').on('dragover', function(e) {\n                e.preventDefault();\n                e.originalEvent.dataTransfer.dropEffect = 'move';\n                $(this).addClass('drag-over');\n            });\n\n            $('.section-item').on('dragleave', function() {\n                $(this).removeClass('drag-over');\n            });\n\n            $('.section-item').on('drop', function(e) {\n                e.preventDefault();\n                var type = e.originalEvent.dataTransfer.getData('type');\n                var fromIndex = parseInt(e.originalEvent.dataTransfer.getData('index'));\n                var toIndex = $(this).data('section-idx');\n\n                if (type === 'section' && fromIndex !== toIndex) {\n                    // Capture collapse state before re-rendering\n                    var expandedSections = self.captureCollapseState();\n\n                    // Reorder sections\n                    var section = self.structure.sections.splice(fromIndex, 1)[0];\n                    self.structure.sections.splice(toIndex, 0, section);\n                    self.markAsModified();\n\n                    // Store expanded state to restore after render\n                    var adjustedExpanded = self.adjustExpandedIndices(expandedSections, fromIndex, toIndex);\n                    self.pendingCollapseState = adjustedExpanded;\n\n                    self.renderStructure();\n                }\n            });\n\n            // Make modules draggable\n            $('.module-item').attr('draggable', 'true');\n\n            $('.module-item').on('dragstart', function(e) {\n                e.stopPropagation();\n                e.originalEvent.dataTransfer.effectAllowed = 'move';\n                e.originalEvent.dataTransfer.setData('type', 'module');\n                e.originalEvent.dataTransfer.setData('sectionIndex', $(this).closest('.section-item').data('section-idx'));\n                e.originalEvent.dataTransfer.setData('moduleIndex', $(this).data('module-idx'));\n                $(this).addClass('dragging');\n            });\n\n            $('.module-item').on('dragend', function() {\n                $(this).removeClass('dragging');\n                $('.drag-over').removeClass('drag-over');\n            });\n\n            $('.module-item').on('dragover', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                e.originalEvent.dataTransfer.dropEffect = 'move';\n                $(this).addClass('drag-over');\n            });\n\n            $('.module-item').on('dragleave', function() {\n                $(this).removeClass('drag-over');\n            });\n\n            $('.module-item').on('drop', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                var type = e.originalEvent.dataTransfer.getData('type');\n\n                if (type === 'module') {\n                    // Capture collapse state before re-rendering\n                    var expandedSections = self.captureCollapseState();\n\n                    var fromSectionIdx = parseInt(e.originalEvent.dataTransfer.getData('sectionIndex'));\n                    var fromModuleIdx = parseInt(e.originalEvent.dataTransfer.getData('moduleIndex'));\n                    var toSectionIdx = $(this).closest('.section-item').data('section-idx');\n                    var toModuleIdx = $(this).data('module-idx');\n\n                    // Move module\n                    var module = self.structure.sections[fromSectionIdx].modules.splice(fromModuleIdx, 1)[0];\n                    self.structure.sections[toSectionIdx].modules.splice(toModuleIdx, 0, module);\n                    self.markAsModified();\n\n                    // Store expanded state to restore after render\n                    self.pendingCollapseState = expandedSections;\n\n                    self.renderStructure();\n                }\n            });\n\n            // Allow dropping modules into empty sections or at the end\n            $('.modules-list').on('dragover', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                e.originalEvent.dataTransfer.dropEffect = 'move';\n            });\n\n            $('.modules-list').on('drop', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                var type = e.originalEvent.dataTransfer.getData('type');\n\n                if (type === 'module') {\n                    // Capture collapse state before re-rendering\n                    var expandedSections = self.captureCollapseState();\n\n                    var fromSectionIdx = parseInt(e.originalEvent.dataTransfer.getData('sectionIndex'));\n                    var fromModuleIdx = parseInt(e.originalEvent.dataTransfer.getData('moduleIndex'));\n                    var toSectionIdx = $(this).closest('.section-item').data('section-idx');\n\n                    // Move module to end of section\n                    var module = self.structure.sections[fromSectionIdx].modules.splice(fromModuleIdx, 1)[0];\n                    self.structure.sections[toSectionIdx].modules.push(module);\n                    self.markAsModified();\n\n                    // Store expanded state to restore after render\n                    self.pendingCollapseState = expandedSections;\n\n                    self.renderStructure();\n                }\n            });\n        },\n\n        /**\n         * Set up event handlers\n         */\n        setupEventHandlers: function() {\n            var self = this;\n\n            // Cleanup on page unload\n            $(window).on('beforeunload', function() {\n                if (self.hasUnsavedChanges) {\n                    // Note: beforeunload message is browser-controlled, but we set it anyway\n                    return self.unsavedChangesMessage || 'You have unsaved changes. Are you sure you want to leave?';\n                }\n            });\n\n            // Load unsaved changes message\n            Str.get_string('editor_unsaved_changes', 'block_dixeo_coursegen').done(function(str) {\n                self.unsavedChangesMessage = str;\n            });\n\n        },\n\n        /**\n         * Update undo/redo button states\n         */\n        updateUndoRedoButtons: function() {\n            var canUndo = this.historyIndex > 0;\n            var canRedo = this.historyIndex < this.historyTotal - 1;\n\n            $('#btn-undo').prop('disabled', !canUndo);\n            $('#btn-redo').prop('disabled', !canRedo);\n        },\n\n        /**\n         * Undo - load previous version in history\n         */\n        undo: function() {\n            if (this.historyIndex <= 0) {\n                return; // Already at oldest\n            }\n\n            // Check for unsaved changes\n            if (this.hasUnsavedChanges) {\n                var self = this;\n                Str.get_strings([\n                    {key: 'editor_reload_confirm', component: 'block_dixeo_coursegen'},\n                    {key: 'cancel', component: 'core'},\n                    {key: 'continue', component: 'core'}\n                ]).done(function(strings) {\n                    Notification.confirm(\n                        strings[0],\n                        '',\n                        strings[2],\n                        strings[1],\n                        function() {\n                            // User confirmed, discard changes and undo\n                            self.hasUnsavedChanges = false;\n                            self.autoSaveEnabled = false;\n                            self.countdown = 60;\n                            $('#countdown-timer').hide();\n                            $('#autosave-label').hide();\n                            self.showLoading();\n                            self.loadStructure(self.historyIndex - 1);\n                        }\n                    );\n                });\n            } else {\n                // No unsaved changes, undo immediately\n                this.showLoading();\n                this.loadStructure(this.historyIndex - 1);\n            }\n        },\n\n        /**\n         * Redo - load next version in history\n         */\n        redo: function() {\n            if (this.historyIndex >= this.historyTotal - 1) {\n                return; // Already at latest\n            }\n\n            // Check for unsaved changes\n            if (this.hasUnsavedChanges) {\n                var self = this;\n                Str.get_strings([\n                    {key: 'editor_reload_confirm', component: 'block_dixeo_coursegen'},\n                    {key: 'cancel', component: 'core'},\n                    {key: 'continue', component: 'core'}\n                ]).done(function(strings) {\n                    Notification.confirm(\n                        strings[0],\n                        '',\n                        strings[2],\n                        strings[1],\n                        function() {\n                            // User confirmed, discard changes and redo\n                            self.hasUnsavedChanges = false;\n                            self.autoSaveEnabled = false;\n                            self.countdown = 60;\n                            $('#countdown-timer').hide();\n                            $('#autosave-label').hide();\n                            self.showLoading();\n                            self.loadStructure(self.historyIndex + 1);\n                        }\n                    );\n                });\n            } else {\n                // No unsaved changes, redo immediately\n                this.showLoading();\n                this.loadStructure(this.historyIndex + 1);\n            }\n        },\n\n        /**\n         * Show saving indicator\n         */\n        showSavingIndicator: function() {\n            // Remove any existing indicators first\n            $('.saving-indicator').remove();\n\n            Str.get_string('editor_saving', 'block_dixeo_coursegen').done(function(str) {\n                var $indicator = $('<div class=\"saving-indicator\"><i class=\"fa fa-spinner fa-spin\"></i> ' + str + '</div>');\n                $('body').append($indicator);\n\n                setTimeout(function() {\n                    $indicator.remove();\n                }, 3000);\n            });\n        },\n\n        /**\n         * Show saved indicator\n         */\n        showSavedIndicator: function() {\n            // Remove any existing indicators first\n            $('.saving-indicator').remove();\n\n            Str.get_string('editor_saved', 'block_dixeo_coursegen').done(function(str) {\n                var $indicator = $('<div class=\"saving-indicator\"><i class=\"fa fa-check\"></i> ' + str + '</div>');\n                $('body').append($indicator);\n\n                setTimeout(function() {\n                    $indicator.fadeOut(function() {\n                        $(this).remove();\n                    });\n                }, 2000);\n            });\n        },\n\n        /**\n         * Show warning when saving from an old version\n         * @param {string} version New version number\n         */\n        showDivergentWarning: function(version) {\n            Str.get_strings([\n                {key: 'editor_divergent_save', component: 'block_dixeo_coursegen'},\n                {key: 'editor_divergent_message', component: 'block_dixeo_coursegen', param: version},\n                {key: 'editor_ok', component: 'block_dixeo_coursegen'}\n            ]).done(function(strings) {\n                Notification.alert(\n                    strings[0],\n                    strings[1],\n                    strings[2]\n                );\n            });\n        }\n    };\n\n    return Editor;\n});\n"],"names":["define","$","Ajax","Notification","Str","Templates","MODULE_TYPE_OPTIONS","value","label","icon","jobid","version","structure","historyIndex","historyTotal","versions","autoSaveInterval","countdownInterval","countdown","currentlyEditing","hasUnsavedChanges","autoSaveEnabled","pendingCollapseState","init","showLoading","loadVersions","startAutoSave","setupEventHandlers","container","get_string","done","str","html","loadStructure","index","self","this","loadIndex","undefined","call","methodname","args","response","JSON","parse","total","renderStructure","updateUndoRedoButtons","fail","error","exception","length","saveStructure","showSavingIndicator","stringify","current_index","showSavedIndicator","clearModified","empty","title","templateContext","summary","image","hasSections","sections","forEach","section","sectionIdx","sectionData","number","hasModules","modules","module","moduleIdx","iconClass","getModuleIcon","type","moduleType","push","sectionIndex","typeUpper","toUpperCase","hints","moduleTypeOptions","get_strings","key","component","then","strings","edit","duplicate","delete","add_section","add_activity","change_activity_type","render","setupEventHandlersAfterRender","catch","setupCollapseHandlers","setupEditableHandlers","setupActionHandlers","setupModuleTypeSelectHandlers","setupDragAndDrop","restoreCollapseState","i","t","toLowerCase","escapeHtml","text","div","document","createElement","textContent","innerHTML","decodeHtml","textarea","captureCollapseState","expandedSections","each","data","collapseTarget","hasClass","adjustExpandedIndices","fromIndex","toIndex","adjusted","Object","keys","idxStr","idx","parseInt","wasExpanded","toggleButton","find","addClass","removeClass","attr","off","on","e","preventDefault","stopPropagation","target","startEditing","$element","originalText","path","focus","range","createRange","selectNodeContents","sel","window","getSelection","removeAllRanges","addRange","$controls","next","show","newText","trim","saveEdit","cancelEdit","click","decodedValue","setValueByPath","markAsModified","removeAttr","hide","obj","parts","match","current","replace","closest","first","duplicateItem","deleteItem","addSection","moduleIndex","addModule","closeAllDropdowns","openDropdown","$wrapper","$dropdown","$toggle","isOpen","opt","not","$moduleType","is","newSection","splice","newModule","$button","$sectionItem","$moduleItem","copySuffix","messageKey","confirm","setInterval","undo","redo","confirmMsg","originalEvent","dataTransfer","effectAllowed","setData","dropEffect","getData","adjustedExpanded","fromSectionIdx","fromModuleIdx","toSectionIdx","toModuleIdx","unsavedChangesMessage","canUndo","canRedo","prop","remove","$indicator","append","setTimeout","fadeOut","showDivergentWarning","param","alert"],"mappings":";;;;;;;;;AAyBAA,sCAAO,CAAC,SAAU,YAAa,oBAAqB,WAAY,mBAC5D,SAASC,EAAGC,KAAMC,aAAcC,IAAKC,eAGjCC,oBAAsB,CACtB,CAACC,MAAO,OAAQC,MAAO,OAAQC,KAAM,eACrC,CAACF,MAAO,sBAAuBC,MAAO,sBAAuBC,KAAM,WACnE,CAACF,MAAO,WAAYC,MAAO,WAAYC,KAAM,eAC7C,CAACF,MAAO,YAAaC,MAAO,YAAaC,KAAM,aAC/C,CAACF,MAAO,MAAOC,MAAO,MAAOC,KAAM,WACnC,CAACF,MAAO,cAAeC,MAAO,cAAeC,KAAM,sBACnD,CAACF,MAAO,OAAQC,MAAO,OAAQC,KAAM,mBACrC,CAACF,MAAO,WAAYC,MAAO,WAAYC,KAAM,mBAC7C,CAACF,MAAO,cAAeC,MAAO,cAAeC,KAAM,cACnD,CAACF,MAAO,aAAcC,MAAO,aAAcC,KAAM,eACjD,CAACF,MAAO,iBAAkBC,MAAO,iBAAkBC,KAAM,oBAGhD,CACTC,MAAO,KACPC,QAAS,GACTC,UAAW,KACXC,cAAe,EACfC,aAAc,EACdC,SAAU,GACVC,iBAAkB,KAClBC,kBAAmB,KACnBC,UAAW,GACXC,iBAAkB,KAClBC,mBAAmB,EACnBC,iBAAiB,EACjBC,qBAAsB,KAMtBC,KAAM,SAASb,YACNA,MAAQA,WAGRc,mBAGAC,oBAGAC,qBAGAC,sBAMTH,YAAa,eACLI,UAAY3B,EAAE,+BAClBG,IAAIyB,WAAW,iBAAkB,yBAAyBC,MAAK,SAASC,KACpEH,UAAUI,KAAK,mHAEUD,IAFV,kBAWvBE,cAAe,SAASC,WAChBC,KAAOC,KACPC,eAAuBC,IAAVJ,MAAuBA,OAAS,EAEjDhC,KAAKqC,KAAK,CAAC,CACPC,WAAY,sCACZC,KAAM,CACF/B,MAAO0B,KAAK1B,MACZwB,MAAOG,WAEXP,KAAM,SAASY,UACXP,KAAKvB,UAAY+B,KAAKC,MAAMF,SAAS9B,WACrCuB,KAAKxB,QAAU+B,SAAS/B,QACxBwB,KAAKtB,aAAe6B,SAASR,MAC7BC,KAAKrB,aAAe4B,SAASG,MAC7BV,KAAKW,kBACLX,KAAKY,yBAETC,KAAM,SAASC,OACX9C,aAAa+C,UAAUD,YAQnCxB,aAAc,eACNU,KAAOC,KAEXlC,KAAKqC,KAAK,CAAC,CACPC,WAAY,qCACZC,KAAM,CACF/B,MAAO0B,KAAK1B,OAEhBoB,KAAM,SAASf,UACXoB,KAAKpB,SAAWA,SAChBoB,KAAKrB,aAAeC,SAASoC,OAE7BhB,KAAKF,iBAETe,KAAM,SAASC,OACX9C,aAAa+C,UAAUD,YAQnCG,cAAe,eACPjB,KAAOC,KAGNA,KAAKhB,yBAKLiC,sBAELnD,KAAKqC,KAAK,CAAC,CACPC,WAAY,uCACZC,KAAM,CACF/B,MAAO0B,KAAK1B,MACZE,UAAW+B,KAAKW,UAAUlB,KAAKxB,WAC/B2C,cAAenB,KAAKvB,cAExBiB,KAAM,SAASY,UACXP,KAAKxB,QAAU+B,SAAS/B,QACxBwB,KAAKtB,aAAe6B,SAASR,MAC7BC,KAAKrB,aAAe4B,SAASG,MAE7BV,KAAKV,eACLU,KAAKqB,qBAGLrB,KAAKsB,gBAGLtB,KAAKY,yBAETC,KAAM,SAASC,OACX9C,aAAa+C,UAAUD,aAQnCH,gBAAiB,eACTX,KAAOC,KACPR,UAAY3B,EAAE,kCAClB2B,UAAU8B,QAELtB,KAAKxB,WAAcwB,KAAKxB,UAAU+C,WAUnCC,gBAAkB,CAClBD,MAAOvB,KAAKxB,UAAU+C,OAAS,GAC/BE,QAASzB,KAAKxB,UAAUiD,SAAW,KACnCC,MAAO1B,KAAKxB,UAAUkD,OAAS,KAC/BpD,MAAO0B,KAAK1B,MACZqD,YAAa3B,KAAKxB,UAAUoD,UAAY5B,KAAKxB,UAAUoD,SAASb,OAAS,EACzEa,SAAU,IAIV5B,KAAKxB,UAAUoD,UAAY5B,KAAKxB,UAAUoD,SAASb,OAAS,QACvDvC,UAAUoD,SAASC,SAAQ,SAASC,QAASC,gBAC1CC,YAAc,CACdlC,MAAOiC,WACPE,OAAQF,WAAa,EACrBR,MAAOO,QAAQP,OAAS,GACxBE,QAASK,QAAQL,SAAW,KAC5BnD,MAAOyB,KAAKzB,MACZ4D,WAAYJ,QAAQK,SAAWL,QAAQK,QAAQpB,OAAS,EACxDoB,QAAS,IAITL,QAAQK,SAAWL,QAAQK,QAAQpB,OAAS,GAC5Ce,QAAQK,QAAQN,SAAQ,SAASO,OAAQC,eACjCC,UAAYvC,KAAKwC,cAAcH,OAAOI,MACtCC,WAAaL,OAAOI,MAAQ,GAChCR,YAAYG,QAAQO,KAAK,CACrB5C,MAAOuC,UACPM,aAAcZ,WACdS,KAAMC,WACNG,UAAWH,WAAWI,cACtBtB,MAAOa,OAAOb,OAAS,GACvBuB,MAAOV,OAAOU,OAAS,KACvBzE,KAAMiE,UACNhE,MAAOyB,KAAKzB,MACZyE,kBAAmB7E,yBAK/BsD,gBAAgBI,SAASc,KAAKV,gBAKtCR,gBAAgBG,YAAcH,gBAAgBI,SAASb,OAAS,EAG3C/C,IAAIgF,YAAY,CACjC,CAACC,IAAK,cAAeC,UAAW,yBAChC,CAACD,IAAK,mBAAoBC,UAAW,yBACrC,CAACD,IAAK,gBAAiBC,UAAW,yBAClC,CAACD,IAAK,qBAAsBC,UAAW,yBACvC,CAACD,IAAK,sBAAuBC,UAAW,yBACxC,CAACD,IAAK,8BAA+BC,UAAW,2BAGrCC,MAAK,SAASC,gBACzB5B,gBAAgB4B,QAAU,CACtBC,KAAMD,QAAQ,GACdE,UAAWF,QAAQ,GACnBG,OAAQH,QAAQ,GAChBI,YAAaJ,QAAQ,GACrBK,aAAcL,QAAQ,GACtBM,qBAAsBN,QAAQ,IAG3BnF,UAAU0F,OAAO,yCAA0CnC,oBACnE2B,MAAK,SAASvD,MACbJ,UAAUI,KAAKA,MACfG,KAAK6D,mCACNC,OAAM,SAAShD,OACd9C,aAAa+C,UAAUD,OACvB7C,IAAIyB,WAAW,sBAAuB,yBAAyBC,MAAK,SAASC,KACzEH,UAAUI,KAAK,mCAAqCD,IAAM,qBApF1DI,KAAOC,KACXhC,IAAIyB,WAAW,sBAAuB,yBAAyBC,MAAK,SAASC,KACzEH,UAAUI,KAAK,mCAAqCD,IAAM,eA0FtEiE,8BAA+B,gBAGtBE,6BAGAC,6BAGAC,2BAGAC,qCAGAC,mBAGDlE,KAAKd,4BACAiF,qBAAqBnE,KAAKd,2BAC1BA,qBAAuB,OASpCqD,cAAe,SAASC,UACfA,WACM,kBAGP4B,EADAC,EAAI7B,KAAK8B,kBAERF,EAAI,EAAGA,EAAIlG,oBAAoB6C,OAAQqD,OACpClG,oBAAoBkG,GAAGjG,MAAMmG,gBAAkBD,SACxCnG,oBAAoBkG,GAAG/F,WAG/B,eAQXkG,WAAY,SAASC,UACZA,WACM,OAEPC,IAAMC,SAASC,cAAc,cACjCF,IAAIG,YAAcJ,KACXC,IAAII,WAQfC,WAAY,SAASN,UACZA,WACM,OAEPO,SAAWL,SAASC,cAAc,mBACtCI,SAASF,UAAYL,KACdO,SAAS5G,OAOpB6G,qBAAsB,eACdjF,KAAOC,KACPiF,iBAAmB,UACvBpH,EAAE,iBAAiBqH,MAAK,eAChBnD,WAAalE,EAAEmC,MAAMmF,KAAK,eAC1BC,eAAiBvH,EAAE,YAAckC,KAAKzB,MAAQ,IAAMyD,YACxDkD,iBAAiBlD,YAAcqD,eAAeC,SAAS,WAEpDJ,kBAUXK,sBAAuB,SAASL,iBAAkBM,UAAWC,YACrDD,YAAcC,eACPP,qBAGPQ,SAAW,UAEfC,OAAOC,KAAKV,kBAAkBpD,SAAQ,SAAS+D,YACvCC,IAAMC,SAASF,QACfG,YAAcd,iBAAiBY,KAE/BA,MAAQN,UAEJQ,cACAN,SAASD,UAAW,GAEjBD,UAAYC,QAEfK,IAAMN,WAAaM,KAAOL,QAC1BC,SAASI,IAAM,GAAKE,YAEpBN,SAASI,KAAOE,YAIhBF,KAAOL,SAAWK,IAAMN,UACxBE,SAASI,IAAM,GAAKE,YAEpBN,SAASI,KAAOE,eAKrBN,UAOXtB,qBAAsB,SAASc,sBACvBlF,KAAOC,KACX0F,OAAOC,KAAKV,kBAAkBpD,SAAQ,SAASE,eACvCkD,iBAAiBlD,YAAa,KAC1BqD,eAAiBvH,EAAE,YAAckC,KAAKzB,MAAQ,IAAMyD,YACpDiE,aAAenI,EAAE,0BAA4BkC,KAAKzB,MAAQ,IAAMyD,WAAa,MAC7E1D,KAAO2H,aAAaC,KAAK,KAE7Bb,eAAec,SAAS,QACxB7H,KAAK8H,YAAY,oBAAoBD,SAAS,mBAC9CF,aAAaI,KAAK,gBAAiB,QAAQD,YAAY,kBAQnErC,sBAAuB,WACnBjG,EAAE,4BAA4BwI,IAAI,SAASC,GAAG,SAAS,SAASC,GAC5DA,EAAEC,iBACFD,EAAEE,sBACEC,OAAS7I,EAAEA,EAAEmC,MAAMmF,KAAK,WACxB9G,KAAOR,EAAEmC,MAAMiG,KAAK,KAEpBS,OAAOrB,SAAS,SAChBqB,OAAOP,YAAY,QACnB9H,KAAK8H,YAAY,mBAAmBD,SAAS,oBAC7CrI,EAAEmC,MAAMoG,KAAK,gBAAiB,SAASF,SAAS,eAEhDQ,OAAOR,SAAS,QAChB7H,KAAK8H,YAAY,oBAAoBD,SAAS,mBAC9CrI,EAAEmC,MAAMoG,KAAK,gBAAiB,QAAQD,YAAY,kBAQ9DpC,sBAAuB,eACfhE,KAAOC,KAEXnC,EAAE,aAAawI,IAAI,SAASC,GAAG,SAAS,WAChCvG,KAAKhB,kBAITgB,KAAK4G,aAAa9I,EAAEmC,WAQ5B2G,aAAc,SAASC,cACf7G,KAAOC,UACNjB,iBAAmB6H,aAEpBC,aAAeD,SAASpC,OACxBsC,KAAOF,SAASzB,KAAK,QAEzByB,SAASV,SAAS,WAClBU,SAASR,KAAK,kBAAmB,QACjCQ,SAASG,YAGLC,MAAQtC,SAASuC,cACrBD,MAAME,mBAAmBN,SAAS,QAC9BO,IAAMC,OAAOC,eACjBF,IAAIG,kBACJH,IAAII,SAASP,WAGTQ,UAAYZ,SAASa,KAAK,kBAC9BD,UAAU5H,KAAK/B,EAAE,2BAA2B+B,QAC5C4H,UAAUE,OAGVF,UAAUvB,KAAK,cAAcI,IAAI,SAASC,GAAG,SAAS,eAC9CqB,QAAUf,SAASpC,OAAOoD,OAC9B7H,KAAK8H,SAASjB,SAAUE,KAAMa,YAIlCH,UAAUvB,KAAK,gBAAgBI,IAAI,SAASC,GAAG,SAAS,WACpDM,SAASpC,KAAKqC,cACd9G,KAAK+H,WAAWlB,aAIfA,SAASvB,SAAS,iBAAoBuB,SAASvB,SAAS,mBACzDuB,SAASP,IAAI,WAAWC,GAAG,WAAW,SAASC,GAC7B,UAAVA,EAAEtD,KACFsD,EAAEC,iBACFgB,UAAUvB,KAAK,cAAc8B,SACZ,WAAVxB,EAAEtD,MACT2D,SAASpC,KAAKqC,cACd9G,KAAK+H,WAAWlB,eAYhCiB,SAAU,SAASjB,SAAUE,KAAM3I,WAE3B6J,aAAehI,KAAK8E,WAAW3G,YAG9B8J,eAAejI,KAAKxB,UAAWsI,KAAMkB,mBAGrCE,sBAGAJ,WAAWlB,UAGhBA,SAASpC,KAAKwD,eAOlBF,WAAY,SAASlB,UACjBA,SAAST,YAAY,WACrBS,SAASuB,WAAW,mBACpBvB,SAASa,KAAK,kBAAkBW,OAAO9G,aAClCvC,iBAAmB,MAS5BkJ,eAAgB,SAASI,IAAKvB,KAAM3I,eAC5BmK,MAAQxB,KAAKyB,MAAM,2BACnBC,QAAUH,IAELjE,EAAI,EAAGA,EAAIkE,MAAMvH,OAAS,EAAGqD,IAAK,CAEvCoE,QAAUA,QADAF,MAAMlE,GAAGqE,QAAQ,UAAW,KAK1CD,QADeF,MAAMA,MAAMvH,OAAS,GAAG0H,QAAQ,UAAW,KACtCtK,OAMxB6F,oBAAqB,eACbjE,KAAOC,KAGXnC,EAAE,kBAAkBwI,IAAI,SAASC,GAAG,SAAS,SAASC,GAClDA,EAAEE,kBACU5I,EAAEmC,MAAM0I,QAAQ,+BACTzC,KAAK,iCAAiC0C,QAClDZ,WAIXlK,EAAE,kBAAkBwI,IAAI,SAASC,GAAG,SAAS,SAASC,GAClDA,EAAEE,kBACF1G,KAAK6I,cAAc/K,EAAEmC,UAIzBnC,EAAE,oBAAoBwI,IAAI,SAASC,GAAG,SAAS,SAASC,GACpDA,EAAEE,kBACF1G,KAAK8I,WAAWhL,EAAEmC,UAItBnC,EAAE,oBAAoBwI,IAAI,SAASC,GAAG,SAAS,SAASC,GACpDA,EAAEE,sBACE9D,aAAemD,SAASjI,EAAEmC,MAAMmF,KAAK,kBACzCpF,KAAK+I,WAAWnG,iBAIpB9E,EAAE,mBAAmBwI,IAAI,SAASC,GAAG,SAAS,SAASC,GACnDA,EAAEE,sBACE9D,aAAemD,SAASjI,EAAEmC,MAAMmF,KAAK,kBACrC4D,YAAcjD,SAASjI,EAAEmC,MAAMmF,KAAK,iBACxCpF,KAAKiJ,UAAUrG,aAAcoG,iBAOrC9E,8BAA+B,eACvBlE,KAAOC,cAGFiJ,oBACLpL,EAAE,gCAAgCqI,SAAS,UAAUE,KAAK,cAAe,QACzEvI,EAAE,8BAA8BuI,KAAK,gBAAiB,kBAOjD8C,aAAaC,cACdC,UAAYD,SAASlD,KAAK,gCAC1BoD,QAAUF,SAASlD,KAAK,8BACxBqD,QAAUF,UAAU/D,SAAS,UAGjC4D,oBAGKK,SACDF,UAAUjD,YAAY,UAAUC,KAAK,cAAe,SACpDiD,QAAQjD,KAAK,gBAAiB,SAKtCvI,EAAE6G,UAAU2B,IAAI,QAAS,8BAA8BC,GAAG,QAAS,8BAA8B,SAASC,GACtGA,EAAEE,kBACFF,EAAEC,iBAEF0C,aADerL,EAAEmC,MAAM0I,QAAQ,mCAKnC7K,EAAE6G,UAAU2B,IAAI,QAAS,gBAAgBC,GAAG,QAAS,gBAAgB,SAASC,GAC1EA,EAAEE,sBAEE0C,SADctL,EAAEmC,MAAM0I,QAAQ,gBACPzC,KAAK,+BAC5BkD,SAASpI,QACTmI,aAAaC,aAKrBtL,EAAE6G,UAAU2B,IAAI,QAAS,uBAAuBC,GAAG,QAAS,uBAAuB,SAASC,GACxFA,EAAEE,sBAQErC,EAPAjG,MAAQN,EAAEmC,MAAMmF,KAAK,SACrBgE,SAAWtL,EAAEmC,MAAM0I,QAAQ,+BAC3B3G,WAAa+D,SAASqD,SAAShE,KAAK,iBAAkB,IACtD9C,UAAYyD,SAASqD,SAAShE,KAAK,gBAAiB,IAGpDoE,IAAM,SAELnF,EAAI,EAAGA,EAAIlG,oBAAoB6C,OAAQqD,OACpClG,oBAAoBkG,GAAGjG,QAAUA,MAAO,CACxCoL,IAAMrL,oBAAoBkG,YAK7BmF,KAKLxJ,KAAKvB,UAAUoD,SAASG,YAAYI,QAAQE,WAAWG,KAAOrE,MAG9DgL,SAASlD,KAAK,gCAAgCuD,IAAI,+BAC7CrD,cAAcD,SAAS,MAAQqD,IAAIlL,KAAO,cAC3CoL,YAAcN,SAAST,QAAQ,gBAAgBzC,KAAK,gBACpDwD,YAAY1I,QACZ0I,YAAYjF,KAAKrG,MAAM0E,eAG3BoG,oBACAlJ,KAAKmI,qBAGTrK,EAAE6G,UAAU2B,IAAI,4BAA4BC,GAAG,4BAA4B,SAASC,GAC3E1I,EAAE0I,EAAEG,QAAQgC,QAAQ,+BAA+B3H,QACpDkI,uBAKRpL,EAAE6G,UAAU2B,IAAI,wBAAyB,8BACpCC,GAAG,wBAAyB,8BAA8B,SAASC,OAE5DkD,YADc5L,EAAEmC,MAAM0I,QAAQ,gBACJzC,KAAK,gBACpB,eAAXM,EAAE/D,MACF3E,EAAEmC,MAAMkG,SAAS,eACjBuD,YAAYvD,SAAS,gBAGhBuD,YAAYC,GAAG,YAChB7L,EAAEmC,MAAMmG,YAAY,eACpBsD,YAAYtD,YAAY,mBAMxCtI,EAAE6G,UAAU2B,IAAI,wBAAyB,gBAAgBC,GAAG,wBAAyB,gBAAgB,SAASC,OAEtG8C,QADcxL,EAAEmC,MAAM0I,QAAQ,gBACRzC,KAAK,8BAChB,eAAXM,EAAE/D,MACF6G,QAAQnD,SAAS,eACjBrI,EAAEmC,MAAMkG,SAAS,gBAGZmD,QAAQK,GAAG,YACZL,QAAQlD,YAAY,eACpBtI,EAAEmC,MAAMmG,YAAY,oBAUpC2C,WAAY,SAAShJ,WACbC,KAAOC,KAEPiF,iBAAmBjF,KAAKgF,uBAG5BhH,IAAIgF,YAAY,CACZ,CAACC,IAAK,2BAA4BC,UAAW,yBAC7C,CAACD,IAAK,6BAA8BC,UAAW,2BAChDxD,MAAK,SAAS0D,aACTuG,WAAa,CACbpI,MAAO6B,QAAQ,GACf3B,QAAS2B,QAAQ,GACjBjB,QAAS,IAIbpC,KAAKvB,UAAUoD,SAASgI,OAAO9J,MAAO,EAAG6J,YAGzC5J,KAAKmI,iBAGLnI,KAAKb,qBAAuB+F,iBAE5BlF,KAAKW,sBASbsI,UAAW,SAASrG,aAAcoG,iBAC1BhJ,KAAOC,KAEPiF,iBAAmBjF,KAAKgF,uBAGvBhF,KAAKxB,UAAUoD,SAASe,cAAcR,eAClC3D,UAAUoD,SAASe,cAAcR,QAAU,IAIpDnE,IAAIgF,YAAY,CACZ,CAACC,IAAK,yBAA0BC,UAAW,yBAC3C,CAACD,IAAK,0BAA2BC,UAAW,yBAC5C,CAACD,IAAK,0BAA2BC,UAAW,2BAC7CxD,MAAK,SAAS0D,aACTyG,UAAY,CACZrH,KAAMY,QAAQ,GACd7B,MAAO6B,QAAQ,GACfN,MAAOM,QAAQ,IAInBrD,KAAKvB,UAAUoD,SAASe,cAAcR,QAAQyH,OAAOb,YAAa,EAAGc,WAGrE9J,KAAKmI,iBAGLjD,iBAAiBtC,eAAgB,EACjC5C,KAAKb,qBAAuB+F,iBAE5BlF,KAAKW,sBAQbkI,cAAe,SAASkB,aAEhB7E,iBAAmBjF,KAAKgF,uBAExB+E,aAAeD,QAAQpB,QAAQ,iBAC/BsB,YAAcF,QAAQpB,QAAQ,gBAE9B3I,KAAOC,KAEXhC,IAAIyB,WAAW,qBAAsB,yBAAyBC,MAAK,SAASuK,eACpED,YAAYjJ,OAAS,EAAG,KAEpBgB,WAAagI,aAAa5E,KAAK,eAC/B9C,UAAY2H,YAAY7E,KAAK,cAC7B/C,OAAS7B,KAAKC,MAAMD,KAAKW,UAAUnB,KAAKvB,UAAUoD,SAASG,YAAYI,QAAQE,aACnFD,OAAOb,MAAQa,OAAOb,MAAQ0I,WAC9BlK,KAAKvB,UAAUoD,SAASG,YAAYI,QAAQyH,OAAOvH,UAAY,EAAG,EAAGD,aAClE,GAAI2H,aAAahJ,OAAS,EAAG,CAE5BgB,WAAagI,aAAa5E,KAAK,mBAC/BrD,QAAUvB,KAAKC,MAAMD,KAAKW,UAAUnB,KAAKvB,UAAUoD,SAASG,cAChED,QAAQP,MAAQO,QAAQP,MAAQ0I,WAChClK,KAAKvB,UAAUoD,SAASgI,OAAO7H,WAAa,EAAG,EAAGD,SAItD/B,KAAKmI,iBAGLnI,KAAKb,qBAAuB+F,iBAE5BlF,KAAKW,sBAQbmI,WAAY,SAASiB,aACb/J,KAAOC,KACP+J,aAAeD,QAAQpB,QAAQ,iBAC/BsB,YAAcF,QAAQpB,QAAQ,gBAE9BwB,WAAaF,YAAYjJ,OAAS,EAAI,+BAAiC,gCAG3E/C,IAAIgF,YAAY,CACZ,CAACC,IAHU,wBAGKC,UAAW,yBAC3B,CAACD,IAAKiH,WAAYhH,UAAW,yBAC7B,CAACD,IAAK,SAAUC,UAAW,QAC3B,CAACD,IAAK,SAAUC,UAAW,UAC5BxD,MAAK,SAAS0D,SACbrF,aAAaoM,QACT/G,QAAQ,GACRA,QAAQ,GACRA,QAAQ,GACRA,QAAQ,IACJ,eAEQ6B,iBAAmBlF,KAAKiF,0BAExBgF,YAAYjJ,OAAS,EAAG,KAEpBgB,WAAagI,aAAa5E,KAAK,eAC/B9C,UAAY2H,YAAY7E,KAAK,cACjCpF,KAAKvB,UAAUoD,SAASG,YAAYI,QAAQyH,OAAOvH,UAAW,QAC3D,GAAI0H,aAAahJ,OAAS,EAAG,CAE5BgB,WAAagI,aAAa5E,KAAK,eACnCpF,KAAKvB,UAAUoD,SAASgI,OAAO7H,WAAY,GAI/ChC,KAAKmI,iBAGLnI,KAAKb,qBAAuB+F,iBAE5BlF,KAAKW,yBASzBwH,eAAgB,gBACPlJ,mBAAoB,EAEpBgB,KAAKf,uBACDA,iBAAkB,OAClBH,UAAY,GACjBjB,EAAE,oBAAoB2G,KAAKxE,KAAKlB,WAAWqH,YAAY,mBAAmBD,SAAS,iBAAiBwB,OACpG7J,EAAE,mBAAmB6J,SAO7BpI,cAAe,eACPS,KAAOC,KAGXnC,EAAE,oBAAoBuK,OACtBvK,EAAE,mBAAmBuK,YAGhBvJ,kBAAoBuL,aAAY,WAC7BrK,KAAKd,iBAAmBc,KAAKf,oBAC7Be,KAAKjB,YACLjB,EAAE,oBAAoB2G,KAAKzE,KAAKjB,WAE5BiB,KAAKjB,WAAa,GAClBiB,KAAKiB,mBAGd,KAGHnD,EAAE,iBAAiByI,GAAG,SAAS,WACvBvG,KAAKf,mBACLe,KAAKiB,mBAKbnD,EAAE,aAAayI,GAAG,SAAS,WACvBvG,KAAKsK,UAITxM,EAAE,aAAayI,GAAG,SAAS,WACvBvG,KAAKuK,UAITzM,EAAE,eAAeyI,GAAG,SAAS,WACzBtI,IAAIyB,WAAW,wBAAyB,yBAAyBC,MAAK,SAAS6K,YACvEJ,QAAQI,cACRxK,KAAKf,mBAAoB,EACzBe,KAAKd,iBAAkB,EACvBc,KAAKjB,UAAY,GAEjBjB,EAAE,oBAAoBuK,OACtBvK,EAAE,mBAAmBuK,OAErBrI,KAAKF,eAAe,WASpCwB,cAAe,gBACNrC,mBAAoB,OACpBC,iBAAkB,OAClBH,UAAY,GAEjBjB,EAAE,oBAAoBuK,OACtBvK,EAAE,mBAAmBuK,QAMzBlE,iBAAkB,eACVnE,KAAOC,KAGXnC,EAAE,iBAAiBuI,KAAK,YAAa,QAErCvI,EAAE,iBAAiByI,GAAG,aAAa,SAASC,GACxCA,EAAEiE,cAAcC,aAAaC,cAAgB,OAC7CnE,EAAEiE,cAAcC,aAAaE,QAAQ,OAAQ,WAC7CpE,EAAEiE,cAAcC,aAAaE,QAAQ,QAAS9M,EAAEmC,MAAMmF,KAAK,gBAC3DtH,EAAEmC,MAAMkG,SAAS,eAGrBrI,EAAE,iBAAiByI,GAAG,WAAW,WAC7BzI,EAAEmC,MAAMmG,YAAY,YACpBtI,EAAE,cAAcsI,YAAY,gBAGhCtI,EAAE,iBAAiByI,GAAG,YAAY,SAASC,GACvCA,EAAEC,iBACFD,EAAEiE,cAAcC,aAAaG,WAAa,OAC1C/M,EAAEmC,MAAMkG,SAAS,gBAGrBrI,EAAE,iBAAiByI,GAAG,aAAa,WAC/BzI,EAAEmC,MAAMmG,YAAY,gBAGxBtI,EAAE,iBAAiByI,GAAG,QAAQ,SAASC,GACnCA,EAAEC,qBACEhE,KAAO+D,EAAEiE,cAAcC,aAAaI,QAAQ,QAC5CtF,UAAYO,SAASS,EAAEiE,cAAcC,aAAaI,QAAQ,UAC1DrF,QAAU3H,EAAEmC,MAAMmF,KAAK,kBAEd,YAAT3C,MAAsB+C,YAAcC,QAAS,KAEzCP,iBAAmBlF,KAAKiF,uBAGxBlD,QAAU/B,KAAKvB,UAAUoD,SAASgI,OAAOrE,UAAW,GAAG,GAC3DxF,KAAKvB,UAAUoD,SAASgI,OAAOpE,QAAS,EAAG1D,SAC3C/B,KAAKmI,qBAGD4C,iBAAmB/K,KAAKuF,sBAAsBL,iBAAkBM,UAAWC,SAC/EzF,KAAKb,qBAAuB4L,iBAE5B/K,KAAKW,sBAKb7C,EAAE,gBAAgBuI,KAAK,YAAa,QAEpCvI,EAAE,gBAAgByI,GAAG,aAAa,SAASC,GACvCA,EAAEE,kBACFF,EAAEiE,cAAcC,aAAaC,cAAgB,OAC7CnE,EAAEiE,cAAcC,aAAaE,QAAQ,OAAQ,UAC7CpE,EAAEiE,cAAcC,aAAaE,QAAQ,eAAgB9M,EAAEmC,MAAM0I,QAAQ,iBAAiBvD,KAAK,gBAC3FoB,EAAEiE,cAAcC,aAAaE,QAAQ,cAAe9M,EAAEmC,MAAMmF,KAAK,eACjEtH,EAAEmC,MAAMkG,SAAS,eAGrBrI,EAAE,gBAAgByI,GAAG,WAAW,WAC5BzI,EAAEmC,MAAMmG,YAAY,YACpBtI,EAAE,cAAcsI,YAAY,gBAGhCtI,EAAE,gBAAgByI,GAAG,YAAY,SAASC,GACtCA,EAAEC,iBACFD,EAAEE,kBACFF,EAAEiE,cAAcC,aAAaG,WAAa,OAC1C/M,EAAEmC,MAAMkG,SAAS,gBAGrBrI,EAAE,gBAAgByI,GAAG,aAAa,WAC9BzI,EAAEmC,MAAMmG,YAAY,gBAGxBtI,EAAE,gBAAgByI,GAAG,QAAQ,SAASC,MAClCA,EAAEC,iBACFD,EAAEE,kBAGW,WAFFF,EAAEiE,cAAcC,aAAaI,QAAQ,QAEzB,KAEf5F,iBAAmBlF,KAAKiF,uBAExB+F,eAAiBjF,SAASS,EAAEiE,cAAcC,aAAaI,QAAQ,iBAC/DG,cAAgBlF,SAASS,EAAEiE,cAAcC,aAAaI,QAAQ,gBAC9DI,aAAepN,EAAEmC,MAAM0I,QAAQ,iBAAiBvD,KAAK,eACrD+F,YAAcrN,EAAEmC,MAAMmF,KAAK,cAG3B/C,OAASrC,KAAKvB,UAAUoD,SAASmJ,gBAAgB5I,QAAQyH,OAAOoB,cAAe,GAAG,GACtFjL,KAAKvB,UAAUoD,SAASqJ,cAAc9I,QAAQyH,OAAOsB,YAAa,EAAG9I,QACrErC,KAAKmI,iBAGLnI,KAAKb,qBAAuB+F,iBAE5BlF,KAAKW,sBAKb7C,EAAE,iBAAiByI,GAAG,YAAY,SAASC,GACvCA,EAAEC,iBACFD,EAAEE,kBACFF,EAAEiE,cAAcC,aAAaG,WAAa,UAG9C/M,EAAE,iBAAiByI,GAAG,QAAQ,SAASC,MACnCA,EAAEC,iBACFD,EAAEE,kBAGW,WAFFF,EAAEiE,cAAcC,aAAaI,QAAQ,QAEzB,KAEf5F,iBAAmBlF,KAAKiF,uBAExB+F,eAAiBjF,SAASS,EAAEiE,cAAcC,aAAaI,QAAQ,iBAC/DG,cAAgBlF,SAASS,EAAEiE,cAAcC,aAAaI,QAAQ,gBAC9DI,aAAepN,EAAEmC,MAAM0I,QAAQ,iBAAiBvD,KAAK,eAGrD/C,OAASrC,KAAKvB,UAAUoD,SAASmJ,gBAAgB5I,QAAQyH,OAAOoB,cAAe,GAAG,GACtFjL,KAAKvB,UAAUoD,SAASqJ,cAAc9I,QAAQO,KAAKN,QACnDrC,KAAKmI,iBAGLnI,KAAKb,qBAAuB+F,iBAE5BlF,KAAKW,uBAQjBnB,mBAAoB,eACZQ,KAAOC,KAGXnC,EAAEuJ,QAAQd,GAAG,gBAAgB,cACrBvG,KAAKf,yBAEEe,KAAKoL,uBAAyB,+DAK7CnN,IAAIyB,WAAW,yBAA0B,yBAAyBC,MAAK,SAASC,KAC5EI,KAAKoL,sBAAwBxL,QAQrCgB,sBAAuB,eACfyK,QAAUpL,KAAKvB,aAAe,EAC9B4M,QAAUrL,KAAKvB,aAAeuB,KAAKtB,aAAe,EAEtDb,EAAE,aAAayN,KAAK,YAAaF,SACjCvN,EAAE,aAAayN,KAAK,YAAaD,UAMrChB,KAAM,gBACErK,KAAKvB,cAAgB,MAKrBuB,KAAKhB,kBAAmB,KACpBe,KAAOC,KACXhC,IAAIgF,YAAY,CACZ,CAACC,IAAK,wBAAyBC,UAAW,yBAC1C,CAACD,IAAK,SAAUC,UAAW,QAC3B,CAACD,IAAK,WAAYC,UAAW,UAC9BxD,MAAK,SAAS0D,SACbrF,aAAaoM,QACT/G,QAAQ,GACR,GACAA,QAAQ,GACRA,QAAQ,IACR,WAEIrD,KAAKf,mBAAoB,EACzBe,KAAKd,iBAAkB,EACvBc,KAAKjB,UAAY,GACjBjB,EAAE,oBAAoBuK,OACtBvK,EAAE,mBAAmBuK,OACrBrI,KAAKX,cACLW,KAAKF,cAAcE,KAAKtB,aAAe,mBAM9CW,mBACAS,cAAcG,KAAKvB,aAAe,IAO/C6L,KAAM,gBACEtK,KAAKvB,cAAgBuB,KAAKtB,aAAe,MAKzCsB,KAAKhB,kBAAmB,KACpBe,KAAOC,KACXhC,IAAIgF,YAAY,CACZ,CAACC,IAAK,wBAAyBC,UAAW,yBAC1C,CAACD,IAAK,SAAUC,UAAW,QAC3B,CAACD,IAAK,WAAYC,UAAW,UAC9BxD,MAAK,SAAS0D,SACbrF,aAAaoM,QACT/G,QAAQ,GACR,GACAA,QAAQ,GACRA,QAAQ,IACR,WAEIrD,KAAKf,mBAAoB,EACzBe,KAAKd,iBAAkB,EACvBc,KAAKjB,UAAY,GACjBjB,EAAE,oBAAoBuK,OACtBvK,EAAE,mBAAmBuK,OACrBrI,KAAKX,cACLW,KAAKF,cAAcE,KAAKtB,aAAe,mBAM9CW,mBACAS,cAAcG,KAAKvB,aAAe,IAO/CwC,oBAAqB,WAEjBpD,EAAE,qBAAqB0N,SAEvBvN,IAAIyB,WAAW,gBAAiB,yBAAyBC,MAAK,SAASC,SAC/D6L,WAAa3N,EAAE,uEAAyE8B,IAAM,UAClG9B,EAAE,QAAQ4N,OAAOD,YAEjBE,YAAW,WACPF,WAAWD,WACZ,SAOXnK,mBAAoB,WAEhBvD,EAAE,qBAAqB0N,SAEvBvN,IAAIyB,WAAW,eAAgB,yBAAyBC,MAAK,SAASC,SAC9D6L,WAAa3N,EAAE,6DAA+D8B,IAAM,UACxF9B,EAAE,QAAQ4N,OAAOD,YAEjBE,YAAW,WACPF,WAAWG,SAAQ,WACf9N,EAAEmC,MAAMuL,cAEb,SAQXK,qBAAsB,SAASrN,SAC3BP,IAAIgF,YAAY,CACZ,CAACC,IAAK,wBAAyBC,UAAW,yBAC1C,CAACD,IAAK,2BAA4BC,UAAW,wBAAyB2I,MAAOtN,SAC7E,CAAC0E,IAAK,YAAaC,UAAW,2BAC/BxD,MAAK,SAAS0D,SACbrF,aAAa+N,MACT1I,QAAQ,GACRA,QAAQ,GACRA,QAAQ"}